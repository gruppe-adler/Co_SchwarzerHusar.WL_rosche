#include "..\component.hpp"

params ["_units","_plane","_soundPlane","_jm","_planeLights","_waitBeforeJump","_onLanding"];
_planeLights params ["_lightWhite","_lightGreen","_lightRed", "_smokeEmitter"];

sleep _waitBeforeJump;

[_units,_plane,_onLanding] remoteExec ["grad_drop_fnc_jump",0,false];

[_jm,"grad_drop_jm0",_units] remoteExec ["grad_drop_fnc_playSound",0,false];

_lightRed hideObjectGlobal false;
_lightWhite hideObjectGlobal true;

sleep 0.2;

_plane setVariable ["grad_drop_lightStatus","RED",true];

sleep 3;

[_jm,"grad_drop_jm1",_units] remoteExec ["grad_drop_fnc_playSound",0,false];

sleep 10;

_plane animate ["ramp_top", 0];
_plane animate ["ramp_bottom", 0];

sleep 10;

[_jm,"grad_drop_jm3",_units] remoteExec ["grad_drop_fnc_playSound",0,false];

sleep 15;

[_jm,"grad_drop_rearDoor",_units] remoteExec ["grad_drop_fnc_playSound",0,false];

sleep 1.3;

_plane animate ["ramp_top", 1];
_plane animate ["ramp_bottom", 1];

[_plane,_jm] spawn grad_drop_fnc_jumpMasterAnimation;

sleep 36;

[_jm,"grad_drop_jm0",_units] remoteExec ["grad_drop_fnc_playSound",0,false];

sleep 1;

_lightGreen hideObjectGlobal false;
_lightRed hideObjectGlobal true;

sleep 0.2;

_plane setVariable ["grad_drop_lightStatus","GREEN",true];

sleep 0.5;

[_jm,"grad_drop_jm5",_units] remoteExec ["grad_drop_fnc_playSound",0,false];

sleep 5;

waitUntil {
    sleep 2; 
    {_x distance _plane < 30} count _units == 0
};

_plane setVariable ["grad_drop_lightStatus","DELETE",true];
sleep 0.5;
private _posCache = getPos _plane;
private _dirCache = getDir _plane;

detach _plane;
deleteVehicle _jm;
{deleteVehicle _x; false} count _planeLights;
deleteVehicle _plane;

{deleteVehicle _x; false} count _smokeEmitter;
deleteVehicle _soundPlane;